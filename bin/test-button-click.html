<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Edit Button Click</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .edit-page-btn {
            padding: 6px 12px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
        }
        .edit-page-btn:hover {
            background-color: #f5f5f5;
        }
        .delete-page-btn {
            padding: 6px 12px;
            background-color: #fff;
            border: 1px solid #dc3545;
            color: #dc3545;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-page-btn:hover {
            background-color: #f8d7da;
        }
        .log {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Edit/Delete Button Click Test</h1>
    
    <div class="test-section">
        <h2>1. HTML Structure Test</h2>
        <div id="html-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. JavaScript Code Test</h2>
        <div id="js-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Interactive Test - Click Edit/Delete Buttons</h2>
        <p>Click the Edit or Delete buttons below to test the functionality:</p>
        
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Slug</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr data-id="page_test_001">
                    <td>Test Page 1</td>
                    <td>/test-page-1</td>
                    <td>Page</td>
                    <td>PUBLISHED</td>
                    <td>
                        <button type="button" class="edit-page-btn">Edit</button>
                        <button type="button" class="delete-page-btn">Delete</button>
                    </td>
                </tr>
                <tr data-id="page_test_002">
                    <td>Test Page 2</td>
                    <td>/test-page-2</td>
                    <td>Post</td>
                    <td>DRAFT</td>
                    <td>
                        <button type="button" class="edit-page-btn">Edit</button>
                        <button type="button" class="delete-page-btn">Delete</button>
                    </td>
                </tr>
                <tr data-id="page_test_003">
                    <td>Test Page 3</td>
                    <td>/test-page-3</td>
                    <td>Page</td>
                    <td>PUBLISHED</td>
                    <td>
                        <button type="button" class="edit-page-btn">Edit</button>
                        <button type="button" class="delete-page-btn">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div id="click-log" class="log"></div>
    </div>
    
    <script>
        const log = (message, type = 'info') => {
            const logDiv = document.getElementById('click-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'color: red;' : type === 'success' ? 'color: green;' : 'color: blue;';
            logDiv.innerHTML += `<div style="${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}]`, message);
        };
        
        // Test 1: HTML Structure
        function testHTMLStructure() {
            const resultDiv = document.getElementById('html-test-result');
            const tests = [];
            
            // Check if buttons exist
            const editButtons = document.querySelectorAll('.edit-page-btn');
            const deleteButtons = document.querySelectorAll('.delete-page-btn');
            tests.push({
                name: 'Edit buttons found',
                pass: editButtons.length > 0,
                message: `Found ${editButtons.length} edit button(s)`
            });
            
            tests.push({
                name: 'Delete buttons found',
                pass: deleteButtons.length > 0,
                message: `Found ${deleteButtons.length} delete button(s)`
            });
            
            // Check if rows have data-id
            const rows = document.querySelectorAll('tr[data-id]');
            tests.push({
                name: 'Table rows have data-id attribute',
                pass: rows.length > 0,
                message: `Found ${rows.length} row(s) with data-id attribute`
            });
            
            // Display results
            let html = '';
            tests.forEach(test => {
                const className = test.pass ? 'success' : 'error';
                html += `<div class="test-result ${className}">${test.pass ? 'âœ“' : 'âœ—'} ${test.name}: ${test.message}</div>`;
            });
            resultDiv.innerHTML = html;
        }
        
        // Test 2: JavaScript Code (simulate the code from pages.php)
        function testJavaScriptCode() {
            const resultDiv = document.getElementById('js-test-result');
            const tests = [];
            
            try {
                // Simulate the exact code from pages.php
                const editButtons = document.querySelectorAll('.edit-page-btn');
                let handlersAttached = 0;
                
                editButtons.forEach((button) => {
                    // Simulate checking if button can find its row
                    const row = button.closest('tr');
                    if (row && row.dataset.id) {
                        handlersAttached++;
                    }
                });
                
                tests.push({
                    name: 'Can find buttons with querySelectorAll',
                    pass: editButtons.length > 0,
                    message: `querySelectorAll('.edit-page-btn') found ${editButtons.length} button(s)`
                });
                
                tests.push({
                    name: 'Buttons can find their table rows',
                    pass: handlersAttached === editButtons.length,
                    message: `${handlersAttached}/${editButtons.length} buttons can find their rows with data-id`
                });
                
                // Test button structure
                editButtons.forEach((btn, index) => {
                    const row = btn.closest('tr');
                    const id = row ? row.dataset.id : null;
                    tests.push({
                        name: `Button ${index + 1} structure`,
                        pass: row !== null && id !== null && id !== undefined,
                        message: `Button ${index + 1}: row=${!!row}, data-id=${id || 'MISSING'}`
                    });
                });
                
            } catch (error) {
                tests.push({
                    name: 'JavaScript code execution',
                    pass: false,
                    message: `Error: ${error.message}`
                });
            }
            
            // Display results
            let html = '';
            tests.forEach(test => {
                const className = test.pass ? 'success' : 'error';
                html += `<div class="test-result ${className}">${test.pass ? 'âœ“' : 'âœ—'} ${test.name}: ${test.message}</div>`;
            });
            resultDiv.innerHTML = html;
        }
        
        // Test 3: Actual button click handlers (simulating pages.php code)
        function setupButtonHandlers() {
            log('Setting up button handlers...', 'info');
            
            // Edit buttons - exact code from pages.php
            document.querySelectorAll('.edit-page-btn').forEach((button) => {
                button.addEventListener('click', async () => {
                    log('ðŸ–±ï¸ EDIT BUTTON CLICKED!', 'success');
                    
                    const row = button.closest('tr');
                    if (!row) {
                        log('âŒ ERROR: Could not find table row', 'error');
                        alert('Could not find table row. Please refresh the page.');
                        return;
                    }
                    
                    const id = row.dataset.id;
                    log(`ðŸ“ Found row with data-id: ${id}`, 'info');
                    
                    if (!id) {
                        log('âŒ ERROR: Page ID not found in row dataset', 'error');
                        alert('Page ID not found. Please refresh the page.');
                        return;
                    }
                    
                    // Show loading state
                    button.disabled = true;
                    const originalText = button.textContent;
                    button.textContent = 'Loading...';
                    log(`â³ Button changed to loading state (ID: ${id})`, 'info');
                    
                    // Simulate API call (we'll just log it since we don't have a real API)
                    setTimeout(() => {
                        log(`âœ… Would fetch: /api/admin/pages/item.php?id=${encodeURIComponent(id)}`, 'success');
                        log(`âœ… Would open modal with page data for: ${id}`, 'success');
                        
                        // Reset button
                        button.disabled = false;
                        button.textContent = originalText;
                        log(`âœ… Button reset (ID: ${id})`, 'success');
                    }, 500);
                });
            });
            
            // Delete buttons - exact code from pages.php
            document.querySelectorAll('.delete-page-btn').forEach((button) => {
                button.addEventListener('click', async () => {
                    log('ðŸ–±ï¸ DELETE BUTTON CLICKED!', 'success');
                    
                    const row = button.closest('tr');
                    if (!row) {
                        log('âŒ ERROR: Could not find table row', 'error');
                        alert('Could not find table row. Please refresh the page.');
                        return;
                    }
                    
                    const id = row.dataset.id;
                    log(`ðŸ“ Found row with data-id: ${id}`, 'info');
                    
                    if (!id) {
                        log('âŒ ERROR: Page ID not found in row dataset', 'error');
                        alert('Page ID not found. Please refresh the page.');
                        return;
                    }
                    
                    // Get page title for confirmation
                    const pageTitle = row.querySelector('td:first-child')?.textContent?.trim() || 'this page';
                    log(`ðŸ“ Page title: ${pageTitle}`, 'info');
                    
                    if (!confirm(`Are you sure you want to delete "${pageTitle}"?\n\nThis will also delete all sections on this page. This action cannot be undone.`)) {
                        log('âŒ Delete cancelled by user', 'info');
                        return;
                    }
                    
                    // Show loading state
                    button.disabled = true;
                    const originalText = button.textContent;
                    button.textContent = 'Deleting...';
                    log(`â³ Button changed to deleting state (ID: ${id})`, 'info');
                    
                    // Simulate API call
                    setTimeout(() => {
                        log(`âœ… Would DELETE: /api/admin/pages/item.php?id=${encodeURIComponent(id)}`, 'success');
                        log(`âœ… Would reload page after successful delete`, 'success');
                        
                        // Reset button
                        button.disabled = false;
                        button.textContent = originalText;
                        log(`âœ… Button reset (ID: ${id})`, 'success');
                    }, 500);
                });
            });
            
            log(`âœ… All button handlers attached (${document.querySelectorAll('.edit-page-btn').length} edit, ${document.querySelectorAll('.delete-page-btn').length} delete)`, 'success');
        }
        
        // Run tests on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('ðŸš€ Page loaded, starting tests...', 'info');
            testHTMLStructure();
            testJavaScriptCode();
            setupButtonHandlers();
            log('âœ… All tests completed!', 'success');
        });
    </script>
</body>
</html>

